name: ci-mlops-demo

on:
  push:
    branches: [ main ]
  pull_request:

jobs:
  mlops:
    runs-on: ubuntu-latest

    steps:
      # 1) Checkout your mlops-demo repo
      - name: Checkout repo
        uses: actions/checkout@v4
      
         # 2) Checkout private mlops-plugin repo into a subfolder
      - name: Checkout mlops-plugin (private action)
        uses: actions/checkout@v4
        with:
          repository: cyndi-s/mlops-plugin       # <--- your plugin repo
          ref: main                              # or a tag/sha if you prefer
          token: ${{ secrets.MLOPS_PLUGIN_TOKEN }} # PAT with repo read access
          path: .github/mlops-plugin   

      # 2) Set up Python (needed for mlflow + your code)
      - name: Set up Python
        uses: actions/setup-python@v5
        with:
          python-version: "3.11"

      # 3) Install project dependencies (optional but common)
      - name: Install project dependencies
        run: |
          if [ -f "requirements.txt" ]; then
            pip install -r requirements.txt
          fi

      # 4) Run the mlops-plugin (external action repo)
      - name: Run mlops-plugin
        uses: ./.github/mlops-plugin/action   
        with:
          # remote MLflow on DagsHub
          mlflow_tracking_uri: ${{ secrets.MLFLOW_TRACKING_URI }}
          mlflow_token:        ${{ secrets.DAGSHUB_TOKEN }}
          mlflow_username:     ${{ secrets.DAGSHUB_USER }}

          # training behavior
          train: "true"              # let plugin call `mlflow run .`
          install_mlflow: "true"     # plugin will pip install mlflow
          # Gist integration (optional â€“ leave empty for now, plugin will skip)
          gist_id:     ${{ secrets.GIST_ID }}      # or vars.GIST_ID if you stored it as a variable
          gist_token:  ${{ secrets.GIST_TOKEN }}
          gist_filename: "commitHistory.csv"





          # testing